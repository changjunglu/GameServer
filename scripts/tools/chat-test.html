<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯èŠå¤©æ¸¬è©¦</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .chat-container {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            height: 400px;
            overflow-y: auto;
        }
        .chat-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .chat-input input {
            flex: 1;
            padding: 10px;
        }
        .chat-input button {
            padding: 10px 20px;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            background: #f0f0f0;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #e8f5e8;
        }
        .error {
            background: #ffe8e8;
        }
    </style>
</head>
<body>
    <h1>å‰ç«¯èŠå¤©æ¸¬è©¦</h1>
    
    <div class="status" id="status">æœªé€£æ¥</div>
    
    <div>
        <input type="text" id="playerName" placeholder="è¼¸å…¥ç©å®¶åç¨±" value="æ¸¬è©¦ç©å®¶">
        <button onclick="login()">ç™»å…¥</button>
        <button onclick="createRoom()">å‰µå»ºæˆ¿é–“</button>
        <button onclick="sendChat()">ç™¼é€èŠå¤©</button>
        <button onclick="clearChat()">æ¸…ç©ºèŠå¤©</button>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div>ç­‰å¾…é€£æ¥...</div>
    </div>
    
    <div class="chat-input">
        <input type="text" id="chatInput" placeholder="è¼¸å…¥èŠå¤©è¨Šæ¯" onkeypress="handleKeyPress(event)">
        <button onclick="sendChat()">ç™¼é€</button>
    </div>
    
    <div>
        <h3>æ¸¬è©¦çµæœ</h3>
        <div id="testResults"></div>
    </div>

    <script>
        let socket = null;
        let playerName = '';
        let currentRoom = null;
        let chatCount = 0;
        let testResults = [];

        function connect() {
            socket = io('http://localhost:3001');
            
            socket.on('connect', () => {
                updateStatus('å·²é€£æ¥', false);
            });
            
            socket.on('disconnect', () => {
                updateStatus('å·²æ–·é–‹é€£æ¥', true);
            });
            
            socket.on('player-logged-in', (data) => {
                updateStatus(`å·²ç™»å…¥: ${data.player.name}`, false);
                playerName = data.player.name;
            });
            
            socket.on('room-created', (room) => {
                updateStatus(`å·²å‰µå»ºæˆ¿é–“: ${room.name}`, false);
                currentRoom = room;
            });
            
            socket.on('room-new-message', (message) => {
                addMessage(`${message.playerName}: ${message.message}`);
            });
        }

        function updateStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = isError ? 'status error' : 'status';
        }

        function addMessage(message) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.textContent = message;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function login() {
            if (!socket) {
                connect();
            }
            
            const name = document.getElementById('playerName').value;
            if (name.trim()) {
                socket.emit('player-login', name);
            }
        }

        function createRoom() {
            if (socket && playerName) {
                socket.emit('create-room', {
                    name: 'å‰ç«¯èŠå¤©æ¸¬è©¦æˆ¿é–“',
                    maxPlayers: 4,
                    gameType: 'fruit-eating',
                    gameDuration: 10
                });
            }
        }

        function sendChat() {
            if (socket && currentRoom) {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message) {
                    chatCount++;
                    addTestResult(`ç™¼é€ç¬¬${chatCount}æ¬¡èŠå¤©: ${message}`);
                    
                    socket.emit('room-chat', message);
                    input.value = '';
                    
                    // æª¢æŸ¥æ˜¯å¦é”åˆ°6æ¬¡é™åˆ¶
                    if (chatCount === 6) {
                        addTestResult('âš ï¸ å·²ç™¼é€6æ¬¡èŠå¤©ï¼Œæª¢æŸ¥æ˜¯å¦é‚„èƒ½ç¹¼çºŒ...');
                    }
                }
            } else {
                addTestResult('âŒ ç„¡æ³•ç™¼é€èŠå¤©ï¼šæœªé€£æ¥æˆ–æœªåœ¨æˆ¿é–“ä¸­');
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendChat();
            }
        }

        function clearChat() {
            const container = document.getElementById('chatContainer');
            container.innerHTML = '<div>èŠå¤©è¨˜éŒ„å·²æ¸…ç©º</div>';
        }

        function addTestResult(result) {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.textContent = `${new Date().toLocaleTimeString()}: ${result}`;
            resultsDiv.appendChild(resultDiv);
        }

        // è‡ªå‹•æ¸¬è©¦
        function autoTest() {
            addTestResult('ğŸ§ª é–‹å§‹è‡ªå‹•æ¸¬è©¦...');
            
            // ç™»å…¥
            setTimeout(() => {
                login();
                addTestResult('1. å˜—è©¦ç™»å…¥');
            }, 1000);
            
            // å‰µå»ºæˆ¿é–“
            setTimeout(() => {
                createRoom();
                addTestResult('2. å˜—è©¦å‰µå»ºæˆ¿é–“');
            }, 2000);
            
            // ç™¼é€6æ¬¡èŠå¤©
            for (let i = 1; i <= 6; i++) {
                setTimeout(() => {
                    document.getElementById('chatInput').value = `è‡ªå‹•æ¸¬è©¦${i}`;
                    sendChat();
                }, 3000 + i * 1000);
            }
            
            // ç™¼é€ç¬¬7æ¬¡èŠå¤©
            setTimeout(() => {
                document.getElementById('chatInput').value = 'ç¬¬7æ¬¡æ¸¬è©¦';
                sendChat();
                addTestResult('3. å˜—è©¦ç™¼é€ç¬¬7æ¬¡èŠå¤©');
            }, 10000);
            
            // ç™¼é€ç¬¬8æ¬¡èŠå¤©
            setTimeout(() => {
                document.getElementById('chatInput').value = 'ç¬¬8æ¬¡æ¸¬è©¦';
                sendChat();
                addTestResult('4. å˜—è©¦ç™¼é€ç¬¬8æ¬¡èŠå¤©');
            }, 12000);
            
            // çµæŸæ¸¬è©¦
            setTimeout(() => {
                addTestResult('ğŸ‰ è‡ªå‹•æ¸¬è©¦å®Œæˆï¼');
            }, 14000);
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•é–‹å§‹æ¸¬è©¦
        window.onload = function() {
            setTimeout(autoTest, 1000);
        };
    </script>
</body>
</html> 