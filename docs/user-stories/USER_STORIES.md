# 🎮 多人即時遊戲平台 - 用戶故事 (User Stories)

## 📋 文件資訊

| 項目 | 內容 |
|------|------|
| **文件版本** | 1.0 |
| **建立日期** | 2024年12月 |
| **文件狀態** | 草稿 |
| **負責人** | 產品經理 |
| **相關文件** | BRD.md, PRD.md, FRD.md |

---

## 👥 1. 用戶角色定義

### 1.1 主要用戶角色

#### 1.1.1 遊戲玩家 (Player)
- **描述**: 使用平台進行遊戲的主要用戶
- **目標**: 享受遊戲樂趣，與其他玩家互動
- **特徵**: 喜歡多人競技，重視社交體驗

#### 1.1.2 房主 (Host)
- **描述**: 創建遊戲房間的玩家
- **目標**: 管理房間，控制遊戲流程
- **特徵**: 喜歡組織活動，有領導能力

#### 1.1.3 系統管理員 (Admin)
- **描述**: 管理平台運營的技術人員
- **目標**: 確保系統穩定運行
- **特徵**: 具備技術背景，關注系統性能

---

## 📖 2. 用戶故事 (User Stories)

### 2.1 用戶管理相關故事

#### US-001: 玩家登入
**作為** 一個遊戲玩家  
**我希望** 能夠通過輸入名稱登入遊戲系統  
**以便** 開始使用遊戲平台

**驗收標準 (AC)**:
- [ ] 玩家能夠在登入界面輸入名稱
- [ ] 系統驗證名稱不為空且長度在1-20字元內
- [ ] 系統檢查與伺服器的連接狀態
- [ ] 登入成功後自動進入遊戲大廳
- [ ] 登入失敗時顯示適當的錯誤訊息
- [ ] 重複名稱能夠正常處理（使用Socket ID區分）

**業務規則**:
- 名稱不能為空
- 名稱長度限制1-20字元
- 必須先建立WebSocket連接才能登入
- 重複名稱使用Socket ID自動區分

#### US-002: 玩家狀態管理
**作為** 一個遊戲玩家  
**我希望** 系統能夠追蹤我的在線狀態  
**以便** 其他玩家知道我的可用性

**驗收標準 (AC)**:
- [ ] 玩家登入後狀態顯示為"online"
- [ ] 玩家進入遊戲後狀態顯示為"in-game"
- [ ] 玩家斷線後狀態自動更新為"offline"
- [ ] 狀態變化即時同步到所有客戶端
- [ ] 重新連接時能夠恢復之前的狀態

**業務規則**:
- 狀態變化必須即時同步
- 斷線時自動清理用戶狀態
- 重新連接時嘗試恢復狀態

### 2.2 遊戲大廳相關故事

#### US-003: 查看遊戲大廳
**作為** 一個遊戲玩家  
**我希望** 能夠在遊戲大廳中看到在線玩家和可用房間  
**以便** 了解當前遊戲環境

**驗收標準 (AC)**:
- [ ] 大廳顯示所有在線玩家列表
- [ ] 大廳顯示所有可用房間列表
- [ ] 玩家列表包含玩家名稱和狀態
- [ ] 房間列表包含房間名稱、房主、玩家數量、狀態
- [ ] 列表即時更新（新玩家加入/離開時）
- [ ] 顯示系統連接狀態和統計信息

**業務規則**:
- 大廳狀態必須即時更新
- 只顯示狀態為"waiting"的房間
- 顯示房間的詳細信息

#### US-004: 大廳聊天
**作為** 一個遊戲玩家  
**我希望** 能夠在大廳中與其他玩家聊天  
**以便** 進行社交互動

**驗收標準 (AC)**:
- [ ] 玩家能夠在大廳發送文字訊息
- [ ] 訊息包含發送者名稱和時間戳
- [ ] 所有大廳玩家都能看到聊天訊息
- [ ] 聊天記錄限制在最近100條
- [ ] 訊息長度限制在200字元內
- [ ] 防止XSS攻擊（HTML轉義）

**業務規則**:
- 訊息必須包含發送者信息
- 限制聊天記錄數量防止記憶體溢出
- 所有用戶輸入必須進行安全驗證

### 2.3 房間管理相關故事

#### US-005: 創建遊戲房間
**作為** 一個遊戲玩家  
**我希望** 能夠創建自己的遊戲房間  
**以便** 邀請朋友一起遊戲

**驗收標準 (AC)**:
- [ ] 玩家能夠點擊"創建房間"按鈕
- [ ] 彈出房間設定對話框
- [ ] 能夠設定房間名稱（必填）
- [ ] 能夠選擇最大玩家數（2-8人）
- [ ] 能夠選擇遊戲類型（目前支援貪食蛇）
- [ ] 能夠選擇遊戲時長（30秒/60秒）
- [ ] 創建成功後自動加入房間
- [ ] 創建者自動成為房主

**業務規則**:
- 房間名稱不能為空
- 最大玩家數限制在2-8人
- 創建者自動成為房主
- 房間ID必須唯一

#### US-006: 加入遊戲房間
**作為** 一個遊戲玩家  
**我希望** 能夠加入其他玩家創建的房間  
**以便** 參與多人遊戲

**驗收標準 (AC)**:
- [ ] 玩家能夠看到所有可用的房間列表
- [ ] 房間列表顯示房間名稱、房主、玩家數量、狀態
- [ ] 只能加入狀態為"waiting"的房間
- [ ] 不能加入已滿員的房間
- [ ] 不能同時加入多個房間
- [ ] 加入成功後自動進入房間界面
- [ ] 加入失敗時顯示錯誤訊息

**業務規則**:
- 房間必須存在且狀態為"waiting"
- 房間未滿員
- 玩家不在其他房間中
- 遊戲進行中的房間不能加入

#### US-007: 離開遊戲房間
**作為** 一個遊戲玩家  
**我希望** 能夠主動離開當前房間  
**以便** 返回大廳或加入其他房間

**驗收標準 (AC)**:
- [ ] 玩家能夠點擊"離開房間"按鈕
- [ ] 離開後自動返回遊戲大廳
- [ ] 清空房間聊天記錄
- [ ] 重置遊戲狀態
- [ ] 通知房間內其他玩家
- [ ] 如果房主離開，自動轉移房主權限
- [ ] 如果房間空了，自動刪除房間

**業務規則**:
- 離開後清空所有房間相關狀態
- 房主離開時轉移給第一個玩家
- 空房間自動刪除

### 2.4 遊戲功能相關故事

#### US-008: 開始遊戲
**作為** 一個房主  
**我希望** 能夠開始房間內的遊戲  
**以便** 讓所有玩家開始競技

**驗收標準 (AC)**:
- [ ] 只有房主能夠看到"開始遊戲"按鈕
- [ ] 點擊後初始化遊戲數據
- [ ] 為每個玩家初始化蛇和分數
- [ ] 生成初始食物（5個）
- [ ] 設定遊戲時長
- [ ] 通知所有玩家遊戲開始
- [ ] 房間狀態變更為"playing"

**業務規則**:
- 只有房主能夠開始遊戲
- 遊戲進行中不能開始新遊戲
- 必須有玩家在房間中才能開始

#### US-009: 參與多人遊戲
**作為** 一個遊戲玩家  
**我希望** 能夠在多人遊戲中控制自己的角色  
**以便** 與其他玩家競技

**驗收標準 (AC)**:
- [ ] 玩家能夠使用鍵盤方向鍵控制角色
- [ ] 玩家能夠使用虛擬按鈕控制角色
- [ ] 角色移動即時同步到所有玩家
- [ ] 每個玩家有不同顏色的角色
- [ ] 防止角色重複按鍵
- [ ] 角色不能超出遊戲邊界

**業務規則**:
- 角色移動必須即時同步
- 每個玩家角色顏色不同
- 防止重複按鍵造成異常移動

#### US-010: 收集食物得分
**作為** 一個遊戲玩家  
**我希望** 能夠通過收集食物獲得分數  
**以便** 在遊戲中取得優勢

**驗收標準 (AC)**:
- [ ] 玩家控制角色移動到食物位置
- [ ] 接觸食物後自動收集
- [ ] 每個食物獲得10分
- [ ] 食物被收集後生成新食物
- [ ] 保持場上最多5個食物
- [ ] 分數即時更新到排行榜
- [ ] 所有玩家同步看到分數變化

**業務規則**:
- 每個食物10分
- 保持場上最多5個食物
- 分數必須即時同步

#### US-011: 遊戲結束和結果
**作為** 一個遊戲玩家  
**我希望** 能夠看到遊戲結束和最終結果  
**以便** 了解遊戲結果

**驗收標準 (AC)**:
- [ ] 遊戲時間到時自動結束
- [ ] 房主能夠手動結束遊戲
- [ ] 計算所有玩家的最終分數
- [ ] 確定獲勝者（分數最高）
- [ ] 顯示獲勝者信息和分數
- [ ] 顯示所有玩家的分數排名
- [ ] 房間狀態變更為"finished"

**業務規則**:
- 時間到或房主手動結束
- 獲勝者為分數最高的玩家
- 遊戲結束後清理遊戲數據

### 2.5 聊天功能相關故事

#### US-012: 房間聊天
**作為** 一個遊戲玩家  
**我希望** 能夠在房間內與其他玩家聊天  
**以便** 進行遊戲相關的交流

**驗收標準 (AC)**:
- [ ] 玩家能夠在房間內發送聊天訊息
- [ ] 訊息只對房間內玩家可見
- [ ] 訊息包含發送者名稱和時間戳
- [ ] 聊天記錄限制在最近100條
- [ ] 遊戲進行時也能使用聊天
- [ ] 防止XSS攻擊

**業務規則**:
- 只有房間內玩家可見
- 限制聊天記錄數量
- 所有輸入必須安全驗證

---

## 🎯 3. 用戶故事優先級

### 3.1 優先級定義
- **P0 (最高優先級)**: 核心功能，必須實現
- **P1 (高優先級)**: 重要功能，應該實現
- **P2 (中優先級)**: 增強功能，可以實現
- **P3 (低優先級)**: 未來功能，可能實現

### 3.2 用戶故事優先級矩陣

| 故事ID | 故事標題 | 優先級 | 狀態 | 估算工時 |
|--------|----------|--------|------|----------|
| US-001 | 玩家登入 | P0 | ✅ 完成 | 8小時 |
| US-002 | 玩家狀態管理 | P0 | ✅ 完成 | 6小時 |
| US-003 | 查看遊戲大廳 | P0 | ✅ 完成 | 12小時 |
| US-004 | 大廳聊天 | P1 | ✅ 完成 | 10小時 |
| US-005 | 創建遊戲房間 | P0 | ✅ 完成 | 16小時 |
| US-006 | 加入遊戲房間 | P0 | ✅ 完成 | 14小時 |
| US-007 | 離開遊戲房間 | P0 | ✅ 完成 | 8小時 |
| US-008 | 開始遊戲 | P0 | ✅ 完成 | 20小時 |
| US-009 | 參與多人遊戲 | P0 | ✅ 完成 | 24小時 |
| US-010 | 收集食物得分 | P0 | ✅ 完成 | 16小時 |
| US-011 | 遊戲結束和結果 | P0 | ✅ 完成 | 12小時 |
| US-012 | 房間聊天 | P1 | ✅ 完成 | 10小時 |

---

## 📊 4. 用戶故事依賴關係

### 4.1 依賴圖
```
US-001 (登入) 
    ↓
US-002 (狀態管理)
    ↓
US-003 (查看大廳)
    ↓
US-004 (大廳聊天)
    ↓
US-005 (創建房間) ← US-006 (加入房間)
    ↓
US-007 (離開房間)
    ↓
US-008 (開始遊戲)
    ↓
US-009 (參與遊戲) ← US-010 (收集食物)
    ↓
US-011 (遊戲結束)
    ↓
US-012 (房間聊天)
```

### 4.2 並行開發機會
- US-004 (大廳聊天) 和 US-012 (房間聊天) 可以並行開發
- US-005 (創建房間) 和 US-006 (加入房間) 可以並行開發
- US-009 (參與遊戲) 和 US-010 (收集食物) 可以並行開發

---

## 🧪 5. 測試案例

### 5.1 功能測試案例

#### TC-001: 玩家登入測試
**測試目標**: 驗證玩家登入功能正常運作

**前置條件**:
- 系統正常運行
- 網路連接正常

**測試步驟**:
1. 打開遊戲網站
2. 在登入界面輸入有效名稱
3. 點擊"進入大廳"按鈕
4. 觀察是否成功進入大廳

**預期結果**:
- 登入成功
- 進入遊戲大廳
- 玩家名稱正確顯示
- 連接狀態顯示"已連接"

#### TC-002: 創建房間測試
**測試目標**: 驗證房間創建功能正常運作

**前置條件**:
- 玩家已登入系統
- 在遊戲大廳中

**測試步驟**:
1. 點擊"創建房間"按鈕
2. 填寫房間設定（名稱、人數、時長）
3. 點擊"創建"按鈕
4. 觀察是否成功創建房間

**預期結果**:
- 房間創建成功
- 自動加入房間
- 成為房主
- 房間信息正確顯示

#### TC-003: 多人遊戲測試
**測試目標**: 驗證多人遊戲功能正常運作

**前置條件**:
- 房間內有多個玩家
- 房主已開始遊戲

**測試步驟**:
1. 使用鍵盤方向鍵控制角色
2. 移動角色收集食物
3. 觀察分數變化
4. 觀察其他玩家同步

**預期結果**:
- 角色移動正常
- 食物收集成功
- 分數正確計算
- 所有玩家同步看到相同狀態

### 5.2 性能測試案例

#### TC-004: 並發用戶測試
**測試目標**: 驗證系統支援多個同時在線用戶

**測試步驟**:
1. 模擬100個用戶同時登入
2. 創建多個遊戲房間
3. 進行多人遊戲
4. 監控系統性能

**預期結果**:
- 系統響應時間 < 100ms
- 遊戲同步延遲 < 50ms
- 無記憶體洩漏
- 系統穩定運行

#### TC-005: 網路延遲測試
**測試目標**: 驗證系統在網路延遲情況下的表現

**測試步驟**:
1. 模擬網路延遲（100-500ms）
2. 進行多人遊戲
3. 觀察遊戲同步效果
4. 測試斷線重連

**預期結果**:
- 遊戲仍能正常進行
- 同步延遲在可接受範圍內
- 斷線重連功能正常

### 5.3 安全測試案例

#### TC-006: 輸入驗證測試
**測試目標**: 驗證系統輸入驗證機制

**測試步驟**:
1. 嘗試輸入空名稱登入
2. 嘗試輸入超長名稱
3. 嘗試發送包含HTML標籤的聊天訊息
4. 嘗試發送超長聊天訊息

**預期結果**:
- 空名稱被拒絕
- 超長名稱被截斷或拒絕
- HTML標籤被轉義
- 超長訊息被截斷

#### TC-007: XSS防護測試
**測試目標**: 驗證XSS防護機制

**測試步驟**:
1. 在聊天中輸入JavaScript代碼
2. 在名稱中輸入特殊字符
3. 觀察是否被正確處理

**預期結果**:
- JavaScript代碼被轉義
- 特殊字符被安全處理
- 無XSS漏洞

---

## 📈 6. 用戶故事完成度追蹤

### 6.1 完成度統計
- **總故事數**: 12個
- **已完成**: 12個 (100%)
- **進行中**: 0個 (0%)
- **未開始**: 0個 (0%)

### 6.2 功能覆蓋率
- **用戶管理**: 100% (2/2)
- **遊戲大廳**: 100% (2/2)
- **房間管理**: 100% (3/3)
- **遊戲功能**: 100% (4/4)
- **聊天功能**: 100% (1/1)

### 6.3 優先級完成度
- **P0 (最高優先級)**: 100% (9/9)
- **P1 (高優先級)**: 100% (2/2)
- **P2 (中優先級)**: 100% (1/1)
- **P3 (低優先級)**: 100% (0/0)

---

## 🎯 7. 未來用戶故事

### 7.1 計劃中的用戶故事

#### US-013: 用戶註冊和個人資料
**作為** 一個遊戲玩家  
**我希望** 能夠註冊帳號和管理個人資料  
**以便** 保存遊戲記錄和個人設定

#### US-014: 遊戲排行榜
**作為** 一個遊戲玩家  
**我希望** 能夠查看遊戲排行榜  
**以便** 了解自己的遊戲水平

#### US-015: 好友系統
**作為** 一個遊戲玩家  
**我希望** 能夠添加好友和邀請好友遊戲  
**以便** 與朋友一起遊戲

#### US-016: 遊戲統計
**作為** 一個遊戲玩家  
**我希望** 能夠查看自己的遊戲統計  
**以便** 追蹤遊戲進展

### 7.2 技術改進故事

#### US-017: 移動端適配
**作為** 一個移動設備用戶  
**我希望** 能夠在手機上使用遊戲平台  
**以便** 隨時隨地遊戲

#### US-018: 遊戲錄製
**作為** 一個遊戲玩家  
**我希望** 能夠錄製和回放遊戲過程  
**以便** 分享精彩時刻

---

## 📝 8. 附錄

### 8.1 術語定義
- **用戶故事**: 從用戶角度描述的功能需求
- **驗收標準**: 判斷用戶故事是否完成的標準
- **業務規則**: 系統必須遵循的規則和約束
- **測試案例**: 驗證功能是否正常運作的測試步驟

### 8.2 參考文檔
- 業務需求文件 (BRD)
- 產品需求文件 (PRD)
- 功能需求文件 (FRD)
- 使用案例文件 (Use Cases)

---

**文件結束**

*此文件基於程式碼逆向工程分析，反映了當前系統的實際用戶需求和功能特性。*
