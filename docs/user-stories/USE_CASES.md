# 🎮 多人即時遊戲平台 - 使用案例 (Use Cases)

## 📋 文件資訊

| 項目 | 內容 |
|------|------|
| **文件版本** | 1.0 |
| **建立日期** | 2024年12月 |
| **文件狀態** | 草稿 |
| **負責人** | 系統分析師 |
| **相關文件** | BRD.md, PRD.md, FRD.md, USER_STORIES.md |

---

## 👥 1. 角色定義

### 1.1 主要角色

#### 1.1.1 遊戲玩家 (Player)
- **描述**: 使用平台進行遊戲的主要用戶
- **目標**: 享受遊戲樂趣，與其他玩家互動
- **權限**: 登入、聊天、創建房間、加入房間、參與遊戲

#### 1.1.2 房主 (Host)
- **描述**: 創建遊戲房間的玩家
- **目標**: 管理房間，控制遊戲流程
- **特殊權限**: 開始遊戲、結束遊戲、管理房間設定

#### 1.1.3 系統管理員 (Admin)
- **描述**: 管理平台運營的技術人員
- **目標**: 確保系統穩定運行
- **權限**: 監控系統、處理問題、優化性能

---

## 📖 2. 使用案例 (Use Cases)

### 2.1 用戶管理使用案例

#### UC-001: 玩家登入系統

**主要角色**: 遊戲玩家

**前置條件**:
- 系統正常運行
- 網路連接正常
- 玩家尚未登入

**主要流程**:
1. 玩家打開遊戲網站
2. 系統顯示登入界面
3. 玩家輸入名稱
4. 系統驗證名稱有效性
5. 系統建立WebSocket連接
6. 系統發送登入請求到伺服器
7. 伺服器驗證並創建玩家記錄
8. 伺服器返回登入成功回應
9. 系統進入遊戲大廳

**替代流程**:
- **A1**: 名稱為空
  1. 系統顯示錯誤訊息
  2. 返回步驟3
- **A2**: 名稱長度超過限制
  1. 系統截斷或拒絕名稱
  2. 返回步驟3
- **A3**: 網路連接失敗
  1. 系統顯示"連接中..."
  2. 等待連接恢復後重試

**後置條件**:
- 玩家成功登入系統
- 玩家進入遊戲大廳
- 玩家狀態顯示為"online"

**驗收標準 (AC)**:
- [ ] 玩家能夠輸入名稱並成功登入
- [ ] 系統正確驗證名稱格式
- [ ] 網路連接失敗時顯示適當訊息
- [ ] 登入成功後自動進入大廳
- [ ] 重複名稱能夠正常處理

#### UC-002: 玩家狀態管理

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家已登入系統

**主要流程**:
1. 系統追蹤玩家在線狀態
2. 玩家進入遊戲房間
3. 系統更新狀態為"in-game"
4. 玩家離開遊戲房間
5. 系統更新狀態為"online"
6. 玩家斷線
7. 系統更新狀態為"offline"

**替代流程**:
- **A1**: 玩家重新連接
  1. 系統嘗試恢復之前狀態
  2. 如果成功，恢復到"online"
  3. 如果失敗，要求重新登入

**後置條件**:
- 玩家狀態正確反映當前情況
- 狀態變化即時同步到所有客戶端

**驗收標準 (AC)**:
- [ ] 狀態變化即時同步
- [ ] 斷線時自動清理狀態
- [ ] 重新連接時嘗試恢復狀態

### 2.2 遊戲大廳使用案例

#### UC-003: 查看遊戲大廳

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家已登入系統

**主要流程**:
1. 玩家進入遊戲大廳
2. 系統顯示在線玩家列表
3. 系統顯示可用房間列表
4. 系統顯示大廳聊天記錄
5. 系統顯示連接狀態和統計信息
6. 系統即時更新大廳狀態

**替代流程**:
- **A1**: 無在線玩家
  1. 系統顯示空玩家列表
- **A2**: 無可用房間
  1. 系統顯示空房間列表

**後置條件**:
- 玩家能夠看到完整的大廳信息
- 大廳狀態即時更新

**驗收標準 (AC)**:
- [ ] 大廳顯示所有在線玩家
- [ ] 大廳顯示所有可用房間
- [ ] 列表即時更新
- [ ] 顯示系統狀態信息

#### UC-004: 大廳聊天

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家在遊戲大廳中

**主要流程**:
1. 玩家在聊天輸入框輸入訊息
2. 系統驗證訊息內容
3. 玩家點擊發送或按Enter鍵
4. 系統創建聊天訊息對象
5. 系統將訊息添加到聊天記錄
6. 系統廣播訊息給所有大廳玩家
7. 系統限制聊天記錄數量

**替代流程**:
- **A1**: 訊息為空
  1. 系統拒絕發送
- **A2**: 訊息過長
  1. 系統截斷訊息
- **A3**: 訊息包含HTML標籤
  1. 系統轉義HTML標籤

**後置條件**:
- 聊天訊息成功發送
- 所有大廳玩家都能看到訊息
- 聊天記錄保持在限制範圍內

**驗收標準 (AC)**:
- [ ] 玩家能夠發送文字訊息
- [ ] 訊息包含發送者信息
- [ ] 所有大廳玩家都能看到
- [ ] 聊天記錄限制在100條內
- [ ] 防止XSS攻擊

### 2.3 房間管理使用案例

#### UC-005: 創建遊戲房間

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家在遊戲大廳中
- 玩家不在其他房間中

**主要流程**:
1. 玩家點擊"創建房間"按鈕
2. 系統顯示房間設定對話框
3. 玩家填寫房間名稱
4. 玩家選擇最大玩家數（2-8人）
5. 玩家選擇遊戲類型（貪食蛇）
6. 玩家選擇遊戲時長（30秒/60秒）
7. 玩家點擊"創建"按鈕
8. 系統驗證房間設定
9. 系統生成唯一房間ID
10. 系統創建房間記錄
11. 系統將創建者設為房主
12. 系統將創建者加入房間
13. 系統通知所有玩家房間創建
14. 系統進入房間界面

**替代流程**:
- **A1**: 房間名稱為空
  1. 系統顯示錯誤訊息
  2. 返回步驟3
- **A2**: 玩家已在其他房間中
  1. 系統顯示錯誤訊息
  2. 取消創建流程

**後置條件**:
- 房間成功創建
- 創建者成為房主
- 創建者自動加入房間
- 所有玩家都能看到新房間

**驗收標準 (AC)**:
- [ ] 玩家能夠設定房間參數
- [ ] 房間創建成功
- [ ] 創建者成為房主
- [ ] 自動加入房間
- [ ] 其他玩家能看到新房間

#### UC-006: 加入遊戲房間

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家在遊戲大廳中
- 存在可用的遊戲房間
- 玩家不在其他房間中

**主要流程**:
1. 玩家查看房間列表
2. 玩家選擇要加入的房間
3. 玩家點擊"加入"按鈕
4. 系統驗證加入條件
5. 系統將玩家加入房間
6. 系統更新玩家狀態
7. 系統通知房間內其他玩家
8. 系統更新大廳狀態
9. 系統進入房間界面

**替代流程**:
- **A1**: 房間已滿員
  1. 系統顯示"房間已滿"錯誤
  2. 返回步驟1
- **A2**: 房間狀態不是"waiting"
  1. 系統顯示"遊戲進行中"錯誤
  2. 返回步驟1
- **A3**: 玩家已在其他房間中
  1. 系統顯示"請先離開當前房間"錯誤
  2. 返回步驟1

**後置條件**:
- 玩家成功加入房間
- 房間內其他玩家收到通知
- 大廳狀態更新

**驗收標準 (AC)**:
- [ ] 玩家能夠看到可用房間
- [ ] 只能加入"waiting"狀態的房間
- [ ] 不能加入已滿員的房間
- [ ] 加入成功後進入房間
- [ ] 其他玩家收到通知

#### UC-007: 離開遊戲房間

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家在遊戲房間中

**主要流程**:
1. 玩家點擊"離開房間"按鈕
2. 系統確認離開操作
3. 系統從房間玩家列表中移除玩家
4. 系統清空玩家房間狀態
5. 系統通知房間內其他玩家
6. 如果房主離開，系統轉移房主權限
7. 如果房間空了，系統刪除房間
8. 系統更新大廳狀態
9. 系統返回遊戲大廳

**替代流程**:
- **A1**: 玩家是房主且房間有其他玩家
  1. 系統轉移房主權限給第一個玩家
  2. 通知其他玩家權限變更
- **A2**: 房間空了
  1. 系統刪除房間記錄
  2. 通知大廳玩家房間刪除

**後置條件**:
- 玩家成功離開房間
- 返回遊戲大廳
- 房間狀態正確更新

**驗收標準 (AC)**:
- [ ] 玩家能夠離開房間
- [ ] 清空房間相關狀態
- [ ] 通知其他玩家
- [ ] 房主權限正確轉移
- [ ] 空房間自動刪除

### 2.4 遊戲功能使用案例

#### UC-008: 開始遊戲

**主要角色**: 房主

**前置條件**:
- 玩家是房間的房主
- 房間狀態為"waiting"或"finished"
- 房間內有玩家

**主要流程**:
1. 房主點擊"開始遊戲"按鈕
2. 系統驗證房主權限
3. 系統設定房間狀態為"playing"
4. 系統初始化遊戲數據結構
5. 系統為每個玩家初始化蛇和分數
6. 系統生成初始食物（5個）
7. 系統設定遊戲時長
8. 系統通知所有玩家遊戲開始
9. 系統更新大廳狀態

**替代流程**:
- **A1**: 玩家不是房主
  1. 系統拒絕開始遊戲
- **A2**: 房間狀態不是"waiting"或"finished"
  1. 系統拒絕開始遊戲
- **A3**: 房間內沒有玩家
  1. 系統拒絕開始遊戲

**後置條件**:
- 遊戲成功開始
- 所有玩家進入遊戲界面
- 遊戲數據正確初始化

**驗收標準 (AC)**:
- [ ] 只有房主能開始遊戲
- [ ] 遊戲數據正確初始化
- [ ] 所有玩家收到開始通知
- [ ] 房間狀態變更為"playing"

#### UC-009: 參與多人遊戲

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家在遊戲房間中
- 遊戲已開始
- 遊戲狀態為"playing"

**主要流程**:
1. 玩家使用鍵盤方向鍵或虛擬按鈕
2. 系統接收移動指令
3. 系統驗證移動有效性
4. 系統更新角色位置
5. 系統檢查碰撞檢測
6. 系統同步移動到其他玩家
7. 系統檢查食物收集
8. 如果收集到食物，系統增加分數
9. 系統更新分數排行榜

**替代流程**:
- **A1**: 移動超出邊界
  1. 系統拒絕移動
- **A2**: 移動會造成碰撞
  1. 系統拒絕移動
- **A3**: 收集到食物
  1. 系統增加10分
  2. 系統生成新食物
  3. 系統更新排行榜

**後置條件**:
- 角色移動成功
- 所有玩家同步看到移動
- 分數正確更新

**驗收標準 (AC)**:
- [ ] 玩家能夠控制角色移動
- [ ] 移動即時同步到所有玩家
- [ ] 每個玩家有不同顏色
- [ ] 防止重複按鍵
- [ ] 角色不能超出邊界

#### UC-010: 收集食物得分

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家在遊戲中
- 場上有食物

**主要流程**:
1. 玩家控制角色移動到食物位置
2. 系統檢測角色與食物的碰撞
3. 如果碰撞發生，系統收集食物
4. 系統增加玩家分數（10分）
5. 系統從場上移除食物
6. 系統檢查場上食物數量
7. 如果食物少於5個，系統生成新食物
8. 系統更新分數排行榜
9. 系統同步分數變化到所有玩家

**替代流程**:
- **A1**: 沒有碰撞
  1. 繼續遊戲
- **A2**: 場上食物已滿5個
  1. 不生成新食物

**後置條件**:
- 食物被成功收集
- 玩家分數增加
- 新食物生成（如果需要）
- 排行榜更新

**驗收標準 (AC)**:
- [ ] 接觸食物後自動收集
- [ ] 每個食物獲得10分
- [ ] 食物被收集後生成新食物
- [ ] 保持場上最多5個食物
- [ ] 分數即時更新到排行榜

#### UC-011: 遊戲結束和結果

**主要角色**: 遊戲玩家

**前置條件**:
- 遊戲正在進行中
- 遊戲狀態為"playing"

**主要流程**:
1. 遊戲時間到或房主手動結束
2. 系統停止遊戲計時
3. 系統計算所有玩家最終分數
4. 系統確定獲勝者（分數最高）
5. 系統設定房間狀態為"finished"
6. 系統通知所有玩家遊戲結束
7. 系統顯示獲勝者信息和分數
8. 系統顯示所有玩家分數排名
9. 系統清理遊戲數據

**替代流程**:
- **A1**: 房主手動結束
  1. 系統立即結束遊戲
- **A2**: 時間到自動結束
  1. 系統自動結束遊戲

**後置條件**:
- 遊戲成功結束
- 顯示最終結果
- 房間狀態變更為"finished"
- 遊戲數據清理

**驗收標準 (AC)**:
- [ ] 遊戲時間到時自動結束
- [ ] 房主能夠手動結束遊戲
- [ ] 計算所有玩家最終分數
- [ ] 確定獲勝者
- [ ] 顯示獲勝者信息和分數
- [ ] 顯示所有玩家分數排名

### 2.5 聊天功能使用案例

#### UC-012: 房間聊天

**主要角色**: 遊戲玩家

**前置條件**:
- 玩家在遊戲房間中

**主要流程**:
1. 玩家在房間聊天輸入框輸入訊息
2. 系統驗證訊息內容
3. 玩家點擊發送或按Enter鍵
4. 系統創建房間聊天訊息對象
5. 系統將訊息添加到房間聊天記錄
6. 系統發送訊息給房間內所有玩家
7. 系統限制聊天記錄數量

**替代流程**:
- **A1**: 訊息為空
  1. 系統拒絕發送
- **A2**: 訊息過長
  1. 系統截斷訊息
- **A3**: 訊息包含HTML標籤
  1. 系統轉義HTML標籤

**後置條件**:
- 聊天訊息成功發送
- 房間內所有玩家都能看到訊息
- 聊天記錄保持在限制範圍內

**驗收標準 (AC)**:
- [ ] 玩家能夠發送聊天訊息
- [ ] 訊息只對房間內玩家可見
- [ ] 訊息包含發送者信息
- [ ] 聊天記錄限制在100條內
- [ ] 遊戲進行時也能使用聊天
- [ ] 防止XSS攻擊

---

## 🎯 3. 使用案例圖

### 3.1 主要使用案例圖

```
                    🎮 多人遊戲平台
                         │
    ┌────────────────────┼────────────────────┐
    │                    │                    │
    ▼                    ▼                    ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  用戶管理    │    │  遊戲大廳    │    │  房間管理    │
│             │    │             │    │             │
│ UC-001      │    │ UC-003      │    │ UC-005      │
│ 玩家登入     │    │ 查看大廳     │    │ 創建房間     │
│             │    │             │    │             │
│ UC-002      │    │ UC-004      │    │ UC-006      │
│ 狀態管理     │    │ 大廳聊天     │    │ 加入房間     │
└─────────────┘    └─────────────┘    │             │
                                       │ UC-007      │
                                       │ 離開房間     │
                                       └─────────────┘
                                               │
                                               ▼
                                       ┌─────────────┐
                                       │  遊戲功能    │
                                       │             │
                                       │ UC-008      │
                                       │ 開始遊戲     │
                                       │             │
                                       │ UC-009      │
                                       │ 參與遊戲     │
                                       │             │
                                       │ UC-010      │
                                       │ 收集食物     │
                                       │             │
                                       │ UC-011      │
                                       │ 遊戲結束     │
                                       └─────────────┘
                                               │
                                               ▼
                                       ┌─────────────┐
                                       │  聊天功能    │
                                       │             │
                                       │ UC-012      │
                                       │ 房間聊天     │
                                       └─────────────┘
```

### 3.2 角色參與圖

```
遊戲玩家 (Player)
├── UC-001: 玩家登入
├── UC-002: 狀態管理
├── UC-003: 查看遊戲大廳
├── UC-004: 大廳聊天
├── UC-005: 創建遊戲房間
├── UC-006: 加入遊戲房間
├── UC-007: 離開遊戲房間
├── UC-009: 參與多人遊戲
├── UC-010: 收集食物得分
├── UC-011: 遊戲結束和結果
└── UC-012: 房間聊天

房主 (Host)
├── UC-005: 創建遊戲房間
├── UC-008: 開始遊戲
└── UC-011: 遊戲結束和結果

系統管理員 (Admin)
└── 系統監控和管理
```

---

## 📊 4. 使用案例優先級

### 4.1 優先級定義
- **P0 (最高優先級)**: 核心功能，必須實現
- **P1 (高優先級)**: 重要功能，應該實現
- **P2 (中優先級)**: 增強功能，可以實現
- **P3 (低優先級)**: 未來功能，可能實現

### 4.2 使用案例優先級矩陣

| 案例ID | 案例標題 | 優先級 | 狀態 | 估算工時 |
|--------|----------|--------|------|----------|
| UC-001 | 玩家登入系統 | P0 | ✅ 完成 | 8小時 |
| UC-002 | 玩家狀態管理 | P0 | ✅ 完成 | 6小時 |
| UC-003 | 查看遊戲大廳 | P0 | ✅ 完成 | 12小時 |
| UC-004 | 大廳聊天 | P1 | ✅ 完成 | 10小時 |
| UC-005 | 創建遊戲房間 | P0 | ✅ 完成 | 16小時 |
| UC-006 | 加入遊戲房間 | P0 | ✅ 完成 | 14小時 |
| UC-007 | 離開遊戲房間 | P0 | ✅ 完成 | 8小時 |
| UC-008 | 開始遊戲 | P0 | ✅ 完成 | 20小時 |
| UC-009 | 參與多人遊戲 | P0 | ✅ 完成 | 24小時 |
| UC-010 | 收集食物得分 | P0 | ✅ 完成 | 16小時 |
| UC-011 | 遊戲結束和結果 | P0 | ✅ 完成 | 12小時 |
| UC-012 | 房間聊天 | P1 | ✅ 完成 | 10小時 |

---

## 🧪 5. 測試案例

### 5.1 功能測試案例

#### TC-UC-001: 玩家登入流程測試
**測試目標**: 驗證玩家登入使用案例的完整流程

**前置條件**:
- 系統正常運行
- 網路連接正常

**測試步驟**:
1. 打開遊戲網站
2. 在登入界面輸入有效名稱
3. 點擊"進入大廳"按鈕
4. 觀察登入流程
5. 驗證進入大廳

**預期結果**:
- 登入流程正常執行
- 成功進入遊戲大廳
- 玩家狀態正確顯示

#### TC-UC-002: 創建房間流程測試
**測試目標**: 驗證創建房間使用案例的完整流程

**前置條件**:
- 玩家已登入系統
- 在遊戲大廳中

**測試步驟**:
1. 點擊"創建房間"按鈕
2. 填寫房間設定
3. 點擊"創建"按鈕
4. 觀察房間創建流程
5. 驗證進入房間

**預期結果**:
- 房間創建流程正常執行
- 成功創建房間
- 成為房主並進入房間

#### TC-UC-003: 多人遊戲流程測試
**測試目標**: 驗證多人遊戲使用案例的完整流程

**前置條件**:
- 房間內有多個玩家
- 房主已開始遊戲

**測試步驟**:
1. 使用鍵盤控制角色
2. 移動角色收集食物
3. 觀察遊戲同步
4. 驗證分數計算

**預期結果**:
- 遊戲流程正常執行
- 角色移動同步
- 分數正確計算

### 5.2 異常流程測試案例

#### TC-UC-004: 登入異常流程測試
**測試目標**: 驗證登入使用案例的異常處理

**測試步驟**:
1. 嘗試輸入空名稱登入
2. 嘗試輸入超長名稱登入
3. 模擬網路連接失敗
4. 觀察錯誤處理

**預期結果**:
- 空名稱被正確拒絕
- 超長名稱被正確處理
- 網路錯誤顯示適當訊息

#### TC-UC-005: 房間加入異常流程測試
**測試目標**: 驗證加入房間使用案例的異常處理

**測試步驟**:
1. 嘗試加入已滿員的房間
2. 嘗試加入遊戲進行中的房間
3. 嘗試同時加入多個房間
4. 觀察錯誤處理

**預期結果**:
- 已滿員房間被正確拒絕
- 遊戲進行中的房間被正確拒絕
- 多重加入被正確阻止

---

## 📈 6. 使用案例完成度追蹤

### 6.1 完成度統計
- **總案例數**: 12個
- **已完成**: 12個 (100%)
- **進行中**: 0個 (0%)
- **未開始**: 0個 (0%)

### 6.2 功能覆蓋率
- **用戶管理**: 100% (2/2)
- **遊戲大廳**: 100% (2/2)
- **房間管理**: 100% (3/3)
- **遊戲功能**: 100% (4/4)
- **聊天功能**: 100% (1/1)

### 6.3 優先級完成度
- **P0 (最高優先級)**: 100% (9/9)
- **P1 (高優先級)**: 100% (2/2)
- **P2 (中優先級)**: 100% (1/1)
- **P3 (低優先級)**: 100% (0/0)

---

## 🎯 7. 未來使用案例

### 7.1 計劃中的使用案例

#### UC-013: 用戶註冊和個人資料管理
**主要角色**: 遊戲玩家

**描述**: 玩家能夠註冊帳號和管理個人資料

#### UC-014: 遊戲排行榜查看
**主要角色**: 遊戲玩家

**描述**: 玩家能夠查看遊戲排行榜和統計

#### UC-015: 好友系統管理
**主要角色**: 遊戲玩家

**描述**: 玩家能夠添加好友和邀請好友遊戲

#### UC-016: 遊戲統計查看
**主要角色**: 遊戲玩家

**描述**: 玩家能夠查看自己的遊戲統計和記錄

### 7.2 技術改進使用案例

#### UC-017: 移動端適配
**主要角色**: 移動設備用戶

**描述**: 玩家能夠在移動設備上使用遊戲平台

#### UC-018: 遊戲錄製和回放
**主要角色**: 遊戲玩家

**描述**: 玩家能夠錄製和回放遊戲過程

---

## 📝 8. 附錄

### 8.1 術語定義
- **使用案例**: 描述系統如何與用戶互動的場景
- **主要流程**: 正常情況下的標準流程
- **替代流程**: 異常情況下的處理流程
- **前置條件**: 使用案例開始前必須滿足的條件
- **後置條件**: 使用案例結束後系統的狀態

### 8.2 參考文檔
- 業務需求文件 (BRD)
- 產品需求文件 (PRD)
- 功能需求文件 (FRD)
- 用戶故事文件 (User Stories)

---

**文件結束**

*此文件基於程式碼逆向工程分析，反映了當前系統的實際使用案例和功能特性。*
